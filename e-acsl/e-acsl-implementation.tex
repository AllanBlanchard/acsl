%; whizzy section -pdf -initex "pdflatex -ini"
\documentclass[a4paper,web]{frama-c-book}
\usepackage{hevea}
\usepackage{ifthen}

\input{./macros_modern}
\input{framacversion.tex}
%Do not touch the following line. It is used in a Makefile hack to
%produce the ACSL documents for the ACSL working group.
\setboolean{PrintRemarks}{false}

%Do not touch the following line. It is used in a Makefile hack to
%produce the ACSL document shipped with the Frama-C distribution.
%--\setboolean{PrintImplementationRq}{false}

%\setboolean{ColorImplementationRq}{false}

\usepackage{amssymb}
\usepackage{graphicx}
\usepackage{color}
\usepackage{xspace}
\usepackage{makeidx}
\usepackage[normalem]{ulem}
\usepackage[leftbars]{changebar}
\usepackage{alltt}
\makeindex

\newcommand{\version}{1.5-0}

\renewcommand{\textfraction}{0.01}
\renewcommand{\topfraction}{0.99}
\renewcommand{\bottomfraction}{0.99}

\begin{document}
\sloppy
\hbadness=10000

\ifthenelse{\boolean{PrintImplementationRq}}%
  {\coverpage{\vbox{\mbox{E-ACSL Version \version}\newline
\mbox{Implementation in \framacversion{}}}}}%
  {\coverpage{\vbox{\mbox{E-ACSL}\\[2mm]\vbox{\mbox{Executable ANSI/ISO C
          Specification Language}}\\[2mm]
        \mbox{Version \version}}}}

\begin{titlepage}
\includegraphics[height=14mm]{cealistlogo.jpg}
\vfill
\title{E-ACSL\\[5mm]Executable ANSI/ISO C Specification Language}%
{Version \version{}\ifthenelse{\boolean{PrintImplementationRq}}%
{~--~\framacversion}{}}


\author{Julien Signoles}

CEA LIST, Software Reliability Laboratory\\
\vfill
\begin{flushleft}
  \textcopyright 2011 CEA LIST

  This work has been supported by the `Hi-Lite' FUI project (FUI AAP 9).
\end{flushleft}
\end{titlepage}

%%Contents should open on right
\cleardoublepage
\phantomsection
\label{chap:contents}
\tableofcontents

\chapter*{Foreword}

This is a preliminary design of the \eacsl language, a deliverable of
the task 3.4 of the FUI-9 project Hi-Lite
(\url{http://www.open-do.org/projects/hi-lite}).

This is the version \version{} of \eacsl design. Several features may still
evolve in the future.

%% \section*{Acknowledgements}

%% We gratefully thank all the people who contributed to this document:
%% Sylvie Boldo,
%% Jean-Louis Cola\c{c}o,
%% Pierre Cr\'egut,
%% David Delmas,
%% St\'ephane Duprat,
%% Arnaud Gotlieb,
%% Thierry Hubert,
%% Dillon Pariente,
%% Pierre Rousseau,
%% Julien Signoles,
%% Jean Souyris.

\include{intro_modern}

\include{speclang_modern}

\include{libraries_modern}

\include{concl_modern}

\appendix

\chapter{Appendices}
\label{chap:appendix}

%% \section{Glossary}
%% \label{sec:glossary}

%\input{compjml_modern}

%\input{typingrules_modern}

%\input{template_modern}

\section{Changes}

\subsection{Version 1.5-0}

Initial version.

\cleardoublepage
\addcontentsline{toc}{chapter}{\bibname}
\bibliographystyle{plain}
\bibliography{./biblio}

\cleardoublepage
\addcontentsline{toc}{chapter}{\listfigurename}
\listoffigures

\cleardoublepage
\addcontentsline{toc}{chapter}{\indexname}
\printindex

\end{document}
MAIN=main
DEPS_MODERN=macros_modern.tex framacversion.tex biblio.bib \
	intro_modern.tex speclang_modern.tex \
	libraries_modern.tex concl_modern.tex \
	term_modern.bnf binders_modern.bnf predicate_modern.bnf \
	fn_behavior_modern.bnf oldandresult_modern.bnf \
	loc_modern.bnf \
	assertions_modern.bnf loops_modern.bnf st_contracts_modern.bnf

.PHONY: all e-acsl default

default: e-acsl.pdf

e-acsl: e-acsl-implementation.pdf e-acsl.pdf main.pdf

all: e-acsl

# install: acsl-implementation.pdf acsl.pdf
# 	cp -f acsl-implementation.pdf acsl.pdf ../manuals/

include ../../MakeLaTeXModern

framacversion.tex: ../../../VERSION Makefile
	rm -f $@
	printf '\\newcommand{\\framacversion}{' > $@
	cat $< >> $@
	echo '}' >> $@
	chmod a-w $@

%.1: %.mp
	mpost -interaction=batchmode $<

%.mps: %.1
	mv $< $@

%.pp: %.tex pp
	./pp -utf8 $< > $@

%.pp: %.c pp
	./pp -utf8 -c $< > $@

%.tex: %.ctex pp
	rm -f $@
	./pp $< > $@
	chmod a-w $@

%.bnf: %.tex transf
	rm -f $@
	./transf $< > $@
	chmod a-w $@

%_modern.bnf: %.tex transf
	rm -f $@
	./transf -modern $< > $@
	chmod a-w $@

%.ml: %.mll
	ocamllex $<

%.pdf: %.tex
	pdflatex $*
	makeindex $*
	bibtex $*
	pdflatex $*
	pdflatex $*

%.cmo: %.ml
	ocamlc -c $<

pp: pp.ml
	ocamlopt -o $@ str.cmxa $^

transf: transf.cmo transfmain.cmo
	ocamlc -o $@ $^

transfmain.cmo: transf.cmo

.PHONY: clean

clean:
	rm -rf *~ *.aux *.log *.nav *.out *.snm *.toc *.lof *.pp *.bnf \
		*.haux  *.hbbl *.htoc \
                *.cb *.cm? *.bbl *.blg *.idx *.ind *.ilg \
		transf trans.ml pp.ml pp

# version WEB liée à ce qui est implementé
e-acsl-implementation.pdf: $(DEPS_MODERN)

e-acsl-implementation.tex: $(MAIN).tex Makefile
	rm -f $@
	sed -e '/PrintRemarks/s///' $^ > $@
	chmod a-w $@

# version WEB du langage ACSL
e-acsl.pdf: $(DEPS_MODERN)

e-acsl.tex: e-acsl-implementation.tex Makefile
	rm -f $@
	sed -e '/PrintImplementationRq/s/%--//' $^ > $@
	chmod a-w $@

# version pour le goupe de travail ACSL
$(MAIN).pdf: $(DEPS_MODERN)
